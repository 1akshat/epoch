<!DOCTYPE html>
<html>
  <head>
    <title>Epoch Real-time Tests</title>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="../js/epoch/test_data.js"></script>
    <script src="../js/epoch.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/epoch.css">
    <style type="text/css">
      #heatmap {
        height: 125px;
        width: 900px;
      }
    </style>
  </head>
  <body>
    <h1>Fastly Timeseries Test Page</h1>

    <p>Interval: <input type="text" name="interval" value="1000"> <button id="begin">Play</button></p>

    <div id="heatmap" class="epoch"></div>
    <div id="gauge" class="epoch gauge-small"></div>
    <div id="line" class="epoch sparklines" style="width: 812px; height: 30px;margin-left: 44px;"></div>
    <div id="bar" class="epoch category20b" style="width: 900px; height: 200px;"></div>
    <div id="area" class="epoch category20c" style="width: 900px; height: 200px;"></div>

    <script>
      $(function() {
        var heatmap = $('#heatmap').epoch({
          type: 'time.heatmap',
          data: HIST_DATA,
          buckets: 10,
          bucketRange: [0, 100],
          color: 'cubic',
          axes: ['left', 'right', 'bottom']
        });

        var gauge = $('#gauge').epoch({ type: 'time.gauge', value: 0.0 })

        var bar = $('#bar').epoch({
          type: 'time.bar',
          data: TIME_DATA_SHORT_2,
          axes: ['left', 'bottom', 'right', 'top'],
          tickFormats: {
            top: Epoch.Formats.regular
          }
        });

        var line = $('#line').epoch({ 
          type: 'time.line',
          data: TIME_DATA_SHORT_2,
          axes: [] 
        });

        var area = $('#area').epoch({ 
          type: 'time.area',
          data: TIME_DATA_SHORT_2,
          axes: ['left', 'bottom', 'right']
        });

        function pushData() {
          gauge.update(Math.random());

          var entry = nextTimeEntry();
          // console.log(entry);

          bar.push(entry);
          line.push(entry);
          area.push(entry);

          var heatmapEntry = nextHeatmapEntry()
          // console.log(heatmapEntry);
          // console.log(heatmap._queue)
          
          heatmap.push(heatmapEntry);
        }

        var dataInterval = null;

        $('#begin').click(function(e) {
          target = $(e.target)
          if (target.html().toLowerCase() == 'play') {
            dataInterval = setInterval(pushData, parseInt($('[name=interval]').val()));
            target.html('Pause')
          }
          else {
            clearInterval(dataInterval)
            target.html('Play')
          }
        });
      });
    </script>
  </body>
</html>